<div class="container">
  <a href="/" class="back-link">← Back to Home</a>
  
  <div class="movie-detail">
    <div class="movie-header">
      <img src="<%= movie.poster %>" alt="<%= movie.title %>" class="detail-poster">
      <div class="movie-main-info">
        <h1><%= movie.title %></h1>
        <p class="movie-meta">
          <span class="year"><%= movie.year %></span> • 
          <span class="duration"><%= movie.duration %> min</span>
        </p>
        <p class="rating">⭐ <strong><%= movie.rating %>/10</strong> (<%= movie.reviews.length %> reviews)</p>
        <p class="director"><strong>Director:</strong> <%= movie.director %></p>
        <div class="genres">
          <% movie.genre.forEach(g => { %>
            <a href="/genre/<%= g %>" class="genre-tag"><%= g %></a>
          <% }) %>
        </div>
        <p class="cast"><strong>Cast:</strong> <%= movie.cast.join(', ') %></p>
        <% if (movie.trailer) { %>
          <a href="<%= movie.trailer %>" target="_blank" class="trailer-link">Watch Trailer</a>
        <% } %>
      </div>
    </div>
    
    <div class="movie-description">
      <h2>Description</h2>
      <p><%= movie.description %></p>
    </div>
    
    <div class="reviews-section">
      <h2>Reviews (<%= movie.reviews.length %>)</h2>
      
      <% if (user) { %>
        <div class="add-review">
          <h3>Add Your Review</h3>
          <form action="/movie/<%= movie._id %>/review" method="POST" class="review-form">
            <div class="form-group">
              <label for="rating">Rating (1-10):</label>
              <select name="rating" id="rating" required>
                <% for (let i = 1; i <= 10; i++) { %>
                  <option value="<%= i %>"><%= i %></option>
                <% } %>
              </select>
            </div>
            <div class="form-group">
              <label for="comment">Comment:</label>
              <textarea name="comment" id="comment" rows="4" required></textarea>
            </div>
            <button type="submit" class="btn">Submit Review</button>
          </form>
        </div>
      <% } else { %>
        <p class="login-prompt">Please <a href="/auth/login">login</a> to add a review.</p>
      <% } %>
      
      <div class="reviews-list">
        <% if (movie.reviews.length === 0) { %>
          <p class="no-reviews">No reviews yet. Be the first to review!</p>
        <% } else { %>
          <% movie.reviews.slice().reverse().forEach(review => { %>
            <div class="review">
              <div class="review-header">
                <strong><%= review.user %></strong>
                <span class="review-rating">⭐ <%= review.rating %>/10</span>
              </div>
              <p class="review-comment"><%= review.comment %></p>
              <p class="review-date"><%= new Date(review.createdAt).toLocaleDateString() %></p>
            </div>
          <% }) %>
        <% } %>
      </div>
    </div>
  </div>
</div>
